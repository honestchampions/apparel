<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChicMe Product Widget (INR)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #fafafa;
  }
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    padding: 16px;
  }
  .product-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    overflow: hidden;
    background: #fff;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
  }
  .product-card:hover { transform: scale(1.03); }
  .product-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
  }
  .product-card h3 {
    font-size: 14px;
    margin: 8px;
    color: #333;
  }
  .product-card p {
    color: #009688;
    font-weight: bold;
    margin: 4px 0;
  }
  .buy-btn {
    display: inline-block;
    background-color: #e91e63;
    color: white;
    padding: 8px 14px;
    margin: 10px 0 14px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
  }
  .buy-btn:hover { background-color: #c2185b; }
  .loading, .error {
    text-align: center;
    padding: 40px;
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="widget" class="product-grid"></div>
<div id="status" class="loading">Loading ChicMe products (INR)...</div>

<script>
(async function(){
  const params = new URLSearchParams(window.location.search);
  const feedUrl = params.get("feed");
  const widget = document.getElementById("widget");
  const status = document.getElementById("status");

  if(!feedUrl) {
    status.textContent = "Error: No feed URL provided.";
    return;
  }

  try {
    const res = await fetch(feedUrl);
    const xmlText = await res.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(xmlText, "application/xml");

    const offers = xml.querySelectorAll("offer");
    if(offers.length === 0) {
      status.textContent = "No ChicMe products found in feed.";
      return;
    }

    status.remove();

    // --- Currency conversion rate ---
    const EUR_TO_INR = 90; // Adjust if needed

    offers.forEach(offer => {
      const name = offer.querySelector("name")?.textContent || "Product";
      const priceEUR = parseFloat(offer.querySelector("price")?.textContent || "0");
      const priceINR = Math.round(priceEUR * EUR_TO_INR);
      const picture = offer.querySelector("picture")?.textContent || "";
      let url = offer.querySelector("url")?.textContent || "#";

      // Force INR in affiliate link
      url = url.replace(/utm_currency=[A-Z]+/gi, "utm_currency=INR");

      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <img src="${picture}" alt="${name}">
        <h3>${name}</h3>
        <p>â‚¹${priceINR.toLocaleString('en-IN')}</p>
        <a class="buy-btn" href="${url}" target="_blank" rel="noopener">Buy Now at ChicMe</a>
      `;
      widget.appendChild(card);
    });
  } catch (err) {
    status.textContent = "Error loading ChicMe feed.";
    console.error(err);
  }
})();
</script>

</body>
</html>
